# Guide d'intÃ©gration - Catalogue iTakecare (Supabase)

Ce guide vous explique comment intÃ©grer le catalogue iTakecare utilisant l'architecture Supabase Edge Functions.

## ğŸš€ Installation

### 1. DÃ©pendances NPM requises

```bash
npm install @tanstack/react-query framer-motion lucide-react
```

### 2. DÃ©pendances shadcn/ui

Si vous n'avez pas dÃ©jÃ  shadcn/ui configurÃ© :

```bash
npx shadcn-ui@latest add button card badge input slider checkbox alert separator label textarea
```

## ğŸ“ Structure des fichiers

Copiez tous les fichiers `.txt` dans votre projet iTakecare :

```
src/
â”œâ”€â”€ catalog/
â”‚   â”œâ”€â”€ types-catalog.ts          # Types TypeScript
â”‚   â”œâ”€â”€ api-config.ts            # Configuration Supabase
â”‚   â”œâ”€â”€ api-service.ts           # Service API Supabase
â”‚   â”œâ”€â”€ utils-pricing.ts         # Utilitaires prix
â”‚   â”œâ”€â”€ hooks-products.ts        # Hooks React Query
â”‚   â”œâ”€â”€ cart-context.tsx         # Contexte panier
â”‚   â”œâ”€â”€ company-context.tsx      # Contexte entreprise
â”‚   â”œâ”€â”€ hook-simplified-filter.tsx  # Hook filtres
â”‚   â”œâ”€â”€ navigation-bar-clean.tsx # Navigation
â”‚   â”œâ”€â”€ filter-bar-clean.tsx     # Barre de filtres
â”‚   â”œâ”€â”€ product-grid.tsx         # Grille produits
â”‚   â”œâ”€â”€ product-card.tsx         # Carte produit
â”‚   â”œâ”€â”€ catalog-page.tsx         # Page principale
â”‚   â””â”€â”€ cart-page.tsx            # Page panier
```

## âš™ï¸ Configuration

### 1. Configuration API (api-config.ts)

Configurez votre clÃ© API Leazr pour l'intÃ©gration Supabase :

```typescript
export const SUPABASE_CONFIG = {
  // Nom de votre Edge Function (dÃ©jÃ  dÃ©ployÃ©e sur Supabase)
  EDGE_FUNCTION_NAME: 'catalog-api',
  
  // Endpoints disponibles
  ENDPOINTS: {
    PRODUCTS: 'products',
    CATEGORIES: 'categories',
    COMPANY: 'company',
    CUSTOMIZATIONS: 'customizations',
  },
  
  // Remplacez par votre vraie clÃ© API Leazr
  API_KEY: 'lzr_YOUR_API_KEY_HERE', // Remplacez par votre clÃ© API
};
```

### 2. Client Supabase

Assurez-vous que le client Supabase est configurÃ© dans votre projet :

```typescript
// src/integrations/supabase/client.ts doit exister
import { supabase } from '@/integrations/supabase/client';
```

### 3. Wrapper React Query

Dans votre App.tsx ou Ã  la racine :

```typescript
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import CatalogMain from './catalog/catalog-page';

const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 5 * 60 * 1000, // 5 minutes
      cacheTime: 10 * 60 * 1000, // 10 minutes
    },
  },
});

function App() {
  return (
    <QueryClientProvider client={queryClient}>
      {/* Votre contenu iTakecare existant */}
      
      {/* Catalogue intÃ©grÃ© */}
      <CatalogMain companySlug="votre-entreprise-slug" />
    </QueryClientProvider>
  );
}
```

## ğŸ”§ IntÃ©grations possibles

### Option 1 : Page dÃ©diÃ©e

```typescript
// pages/CatalogPage.tsx
import CatalogMain from '../catalog/catalog-page';

const CatalogPage = () => {
  return <CatalogMain companySlug="your-company-slug" />;
};
```

### Option 2 : Iframe intÃ©grÃ©e

```typescript
// Composant pour intÃ©grer dans une iframe
const CatalogIframe = () => {
  return (
    <div style={{ width: '100%', height: '100vh' }}>
      <CatalogMain companySlug="your-company-slug" />
    </div>
  );
};
```

### Option 3 : Modal/Dialog

```typescript
import { Dialog, DialogContent } from '@/components/ui/dialog';
import CatalogMain from '../catalog/catalog-page';

const CatalogModal = ({ isOpen, onClose }) => {
  return (
    <Dialog open={isOpen} onOpenChange={onClose}>
      <DialogContent className="max-w-7xl h-[90vh]">
        <CatalogMain 
          companySlug="your-company-slug"
          onProductSelect={(productId) => {
            // GÃ©rer la sÃ©lection de produit
            console.log('Product selected:', productId);
          }}
        />
      </DialogContent>
    </Dialog>
  );
};
```

## ğŸ¨ Personnalisation

### Styles

Le catalogue utilise Tailwind CSS et respecte les tokens de design. Pour personnaliser :

1. **Couleurs** : Modifiez les classes Tailwind dans les composants
2. **Logo entreprise** : Le logo est automatiquement rÃ©cupÃ©rÃ© depuis l'API
3. **ThÃ¨me** : Les couleurs primaires/secondaires sont appliquÃ©es automatiquement

### Comportements

```typescript
// Exemple de personnalisation
<CatalogMain 
  companySlug="your-company-slug"
  onProductSelect={(productId) => {
    // Redirection personnalisÃ©e
    window.location.href = `/product/${productId}`;
  }}
/>
```

## ğŸ“Š Architecture Supabase - Edge Functions

L'intÃ©gration utilise l'architecture suivante :

```
iTakecare â†’ Supabase Edge Functions â†’ Leazr API â†’ Supabase Database
```

### Endpoints disponibles

Tous les appels passent par l'Edge Function `catalog-api` :

#### GET company info
```javascript
// Via Edge Function
supabase.functions.invoke('catalog-api', {
  body: {
    path: 'v1/{companySlug}/company',
    method: 'GET',
    headers: { 'x-api-key': 'your-api-key' }
  }
})
```

#### GET products
```javascript
supabase.functions.invoke('catalog-api', {
  body: {
    path: 'v1/{companySlug}/products?page=1&limit=50',
    method: 'GET',
    headers: { 'x-api-key': 'your-api-key' }
  }
})
```

#### GET categories
```javascript
supabase.functions.invoke('catalog-api', {
  body: {
    path: 'v1/{companySlug}/categories',
    method: 'GET',
    headers: { 'x-api-key': 'your-api-key' }
  }
})
```

### ClÃ© API requise

Vous devez avoir une clÃ© API Leazr valide commenÃ§ant par `lzr_` pour authentifier les requÃªtes.

## ğŸ” Test et Debug

### 1. VÃ©rification des appels API

Ouvrez les DevTools â†’ Network pour vÃ©rifier que les appels API sont corrects.

### 2. Ã‰tat du cache React Query

Installez React Query DevTools pour debug :

```bash
npm install @tanstack/react-query-devtools
```

```typescript
import { ReactQueryDevtools } from '@tanstack/react-query-devtools';

// Dans votre App.tsx
<ReactQueryDevtools initialIsOpen={false} />
```

### 3. Logs personnalisÃ©s

Le service API inclut des logs console. VÃ©rifiez la console pour les erreurs.

## ğŸš¨ Points d'attention

1. **ClÃ© API** : Configurez votre vraie clÃ© API Leazr dans `SUPABASE_CONFIG.API_KEY`
2. **Edge Function** : L'Edge Function `catalog-api` doit Ãªtre dÃ©ployÃ©e sur votre projet Supabase
3. **Authentication** : Pas besoin de CORS, les Edge Functions gÃ¨rent cela automatiquement
4. **Cache** : Les donnÃ©es sont mises en cache cÃ´tÃ© client pour les performances
5. **Responsive** : Tous les composants sont responsive par dÃ©faut
6. **Persistence panier** : Le panier est sauvegardÃ© en localStorage
7. **Supabase Client** : Assurez-vous que le client Supabase est bien importÃ©

## ğŸ¯ Prochaines Ã©tapes

1. Copiez les fichiers dans votre projet iTakecare
2. Configurez votre vraie clÃ© API Leazr dans `api-config.ts`
3. VÃ©rifiez que le client Supabase est bien configurÃ©
4. Ajoutez le QueryClientProvider si pas dÃ©jÃ  fait
5. Testez avec votre slug d'entreprise (ex: `itakecare`)
6. Personnalisez selon vos besoins

## ğŸ†˜ Support

En cas de problÃ¨me :
1. VÃ©rifiez que la clÃ© API Leazr est correcte dans `api-config.ts`
2. Consultez les logs de l'Edge Function Supabase pour dÃ©bugger
3. VÃ©rifiez que le client Supabase est bien importÃ©
4. Regardez la console navigateur pour les erreurs
5. Testez avec un slug d'entreprise valide comme `itakecare`

L'intÃ©gration utilise l'architecture Supabase existante et est conÃ§ue pour s'intÃ©grer facilement dans votre projet iTakecare.