# Documentation complÃ¨te - iTakecare Catalogue API

**Version:** 1.1.0  
**DerniÃ¨re mise Ã  jour:** 20 novembre 2025  
**Base URL:** `https://cifbetjefyfocafanlhv.supabase.co/functions/v1/catalog-api`

---

## Table des matiÃ¨res

1. [Introduction](#introduction)
2. [Configuration](#configuration)
3. [Endpoints disponibles](#endpoints-disponibles)
4. [Documentation dÃ©taillÃ©e](#documentation-dÃ©taillÃ©e)
5. [Gestion des erreurs](#gestion-des-erreurs)
6. [Rate Limiting](#rate-limiting)
7. [Exemples d'utilisation](#exemples-dutilisation)
8. [Changelog](#changelog)
9. [Guide de migration v1.0 â†’ v1.1](#guide-de-migration)
10. [Cas d'usage recommandÃ©s](#cas-dusage-recommandÃ©s)
11. [Support](#support)

---

## Introduction

L'iTakecare Catalogue API permet d'accÃ©der au catalogue de produits reconditionnÃ©s et services de leasing d'iTakecare. Cette API RESTful fournit des endpoints pour rÃ©cupÃ©rer des informations sur les produits, catÃ©gories, marques, et soumettre des demandes de devis.

**NouveautÃ©s v1.1.0:**
- âœ… Types de catÃ©gories dynamiques avec propriÃ©tÃ©s visuelles (icÃ´nes, couleurs)
- âœ… Endpoint dÃ©diÃ© pour les types de catÃ©gories
- âœ… Endpoint pour les compatibilitÃ©s entre types
- âœ… CatÃ©gories enrichies avec objets type complets

---

## Configuration

### Base URL
```
https://cifbetjefyfocafanlhv.supabase.co/functions/v1/catalog-api
```

### Authentification

Toutes les requÃªtes nÃ©cessitent un header d'authentification:

```http
x-api-key: YOUR_API_KEY
```

**Important:** Contactez iTakecare pour obtenir votre clÃ© API.

### Format des rÃ©ponses

- **Content-Type:** `application/json`
- **Encodage:** UTF-8
- Toutes les rÃ©ponses incluent un statut HTTP appropriÃ©

---

## Endpoints disponibles

### Informations Entreprise

| MÃ©thode | Endpoint | Description |
|---------|----------|-------------|
| GET | `/v1/{companySlug}/company` | Informations sur l'entreprise |

### Produits

| MÃ©thode | Endpoint | Description |
|---------|----------|-------------|
| GET | `/v1/{companySlug}/products` | Liste des produits avec filtres |
| GET | `/v1/{companySlug}/products/{productId}` | DÃ©tail d'un produit spÃ©cifique |

### CatÃ©gories

| MÃ©thode | Endpoint | Description |
|---------|----------|-------------|
| GET | `/v1/{companySlug}/categories` | Liste des catÃ©gories avec types enrichis |
| GET | `/v1/{companySlug}/category-types` | â­ **NOUVEAU** - Types de catÃ©gories dynamiques |
| GET | `/v1/{companySlug}/compatibilities` | â­ **NOUVEAU** - CompatibilitÃ©s entre types |

### Marques

| MÃ©thode | Endpoint | Description |
|---------|----------|-------------|
| GET | `/v1/{companySlug}/brands` | Liste des marques disponibles |

### Panier

| MÃ©thode | Endpoint | Description |
|---------|----------|-------------|
| POST | `/v1/{companySlug}/cart/submit` | Soumettre une demande de devis |

---

## Documentation dÃ©taillÃ©e

### GET /v1/{companySlug}/company

RÃ©cupÃ¨re les informations sur l'entreprise.

**ParamÃ¨tres:**
- `companySlug` (path) - Slug de l'entreprise (ex: `itakecare`)

**RÃ©ponse:**
```json
{
  "id": "c1ce66bb-3ad2-474d-b477-583baa7ff1c0",
  "name": "iTakecare",
  "slug": "itakecare",
  "logo_url": "https://...",
  "primary_color": "#3B82F6",
  "secondary_color": "#10B981"
}
```

---

### GET /v1/{companySlug}/products

Liste paginÃ©e des produits avec filtres avancÃ©s.

**ParamÃ¨tres de requÃªte:**

| ParamÃ¨tre | Type | Description | Exemple |
|-----------|------|-------------|---------|
| `search` | string | Recherche textuelle | `?search=macbook` |
| `category` | string | Filtre par catÃ©gorie ID | `?category=xxx-yyy-zzz` |
| `brand` | string | Filtre par marque | `?brand=Apple` |
| `minPrice` | number | Prix minimum | `?minPrice=500` |
| `maxPrice` | number | Prix maximum | `?maxPrice=2000` |
| `page` | number | NumÃ©ro de page (dÃ©faut: 1) | `?page=2` |
| `limit` | number | Produits par page (dÃ©faut: 20, max: 100) | `?limit=50` |

**RÃ©ponse:**
```json
{
  "products": [
    {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "name": "MacBook Pro 13\" M1",
      "slug": "macbook-pro-13-m1",
      "price": 1299,
      "monthly_price": 45.99,
      "image_url": "https://...",
      "brand": "Apple",
      "category": "Ordinateur portable",
      "description": "MacBook Pro reconditionnÃ© avec puce M1...",
      "short_description": "Puissance et efficacitÃ© Ã©nergÃ©tique",
      "active": true,
      "has_variants": true,
      "variants_count": 3,
      "min_variant_price": 1199,
      "specifications": {
        "processor": "Apple M1",
        "ram": "8 GB",
        "storage": "256 GB SSD",
        "screen": "13.3 pouces Retina"
      }
    }
  ],
  "total": 145,
  "page": 1,
  "totalPages": 8,
  "categories": [...],
  "brands": [...]
}
```

---

### GET /v1/{companySlug}/products/{productId}

DÃ©tail complet d'un produit spÃ©cifique (par ID ou slug).

**ParamÃ¨tres:**
- `companySlug` (path) - Slug de l'entreprise
- `productId` (path) - ID UUID ou slug du produit

**RÃ©ponse:**
```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "name": "MacBook Pro 13\" M1",
  "slug": "macbook-pro-13-m1",
  "price": 1299,
  "monthly_price": 45.99,
  "image_url": "https://...",
  "brand": "Apple",
  "category": "Ordinateur portable",
  "description": "Description complÃ¨te du produit...",
  "short_description": "RÃ©sumÃ© court",
  "active": true,
  "has_variants": true,
  "variants": [
    {
      "id": "variant-1",
      "name": "256GB / 8GB RAM",
      "price": 1199,
      "monthly_price": 42.99,
      "image_url": "https://...",
      "attributes": {
        "storage": "256GB",
        "ram": "8GB"
      },
      "active": true
    },
    {
      "id": "variant-2",
      "name": "512GB / 16GB RAM",
      "price": 1499,
      "monthly_price": 52.99,
      "attributes": {
        "storage": "512GB",
        "ram": "16GB"
      },
      "active": true
    }
  ],
  "variation_attributes": {
    "storage": ["256GB", "512GB", "1TB"],
    "ram": ["8GB", "16GB", "32GB"]
  },
  "specifications": {
    "processor": "Apple M1",
    "screen": "13.3 pouces Retina",
    "graphics": "GPU 8 cÅ“urs",
    "battery": "Jusqu'Ã  20 heures"
  }
}
```

---

### GET /v1/{companySlug}/categories

â­ **MISE Ã€ JOUR v1.1.0** - Liste des catÃ©gories avec types enrichis et donnÃ©es environnementales.

**Changement majeur:** Le champ `type` retourne maintenant un objet `CategoryType` complet au lieu d'une simple string.

**RÃ©ponse:**
```json
{
  "categories": [
    {
      "id": "cat-123",
      "name": "MacBook Pro",
      "translation": "Ordinateur portable professionnel",
      "type": {
        "value": "device",
        "label": "Appareil",
        "icon": "ğŸ“±",
        "bg_color": "bg-blue-100",
        "text_color": "text-blue-800",
        "display_order": 1
      },
      "description": "MacBook Pro reconditionnÃ©s de qualitÃ© premium",
      "count": 24,
      "environmental_impact": {
        "co2_savings_kg": 156,
        "carbon_footprint_reduction_percentage": 75,
        "energy_savings_kwh": 450,
        "water_savings_liters": 12000,
        "waste_reduction_kg": 8,
        "source_url": "https://www.ademe.fr/...",
        "last_updated": "2025-11-15T10:00:00Z"
      }
    },
    {
      "id": "cat-456",
      "name": "Souris sans fil",
      "translation": "Accessoire de pointage",
      "type": {
        "value": "accessory",
        "label": "Accessoire",
        "icon": "ğŸ”Œ",
        "bg_color": "bg-green-100",
        "text_color": "text-green-800",
        "display_order": 2
      },
      "count": 18,
      "environmental_impact": null
    }
  ]
}
```

**Notes importantes:**
- `type` est maintenant un objet avec propriÃ©tÃ©s visuelles
- `environmental_impact` peut Ãªtre `null` si non disponible
- Les couleurs utilisent les classes Tailwind CSS

---

### GET /v1/{companySlug}/category-types

â­ **NOUVEAU v1.1.0** - RÃ©cupÃ¨re tous les types de catÃ©gories disponibles avec leurs propriÃ©tÃ©s visuelles.

**Utilisation:** Pour afficher des filtres dynamiques, badges, ou lÃ©gendes dans votre UI.

**RÃ©ponse:**
```json
{
  "category_types": [
    {
      "value": "device",
      "label": "Appareil",
      "icon": "ğŸ“±",
      "bg_color": "bg-blue-100",
      "text_color": "text-blue-800",
      "display_order": 1
    },
    {
      "value": "accessory",
      "label": "Accessoire",
      "icon": "ğŸ”Œ",
      "bg_color": "bg-green-100",
      "text_color": "text-green-800",
      "display_order": 2
    },
    {
      "value": "service",
      "label": "Service",
      "icon": "ğŸ› ï¸",
      "bg_color": "bg-purple-100",
      "text_color": "text-purple-800",
      "display_order": 3
    },
    {
      "value": "software",
      "label": "Logiciel",
      "icon": "ğŸ’¾",
      "bg_color": "bg-orange-100",
      "text_color": "text-orange-800",
      "display_order": 4
    },
    {
      "value": "consumable",
      "label": "Consommable",
      "icon": "ğŸ“¦",
      "bg_color": "bg-yellow-100",
      "text_color": "text-yellow-800",
      "display_order": 5
    }
  ]
}
```

**Cas d'usage:**
- CrÃ©er des filtres par type de catÃ©gorie
- Afficher des badges colorÃ©s pour chaque catÃ©gorie
- Construire une lÃ©gende visuelle du catalogue
- Synchroniser les couleurs entre applications

---

### GET /v1/{companySlug}/compatibilities

â­ **NOUVEAU v1.1.0** - RÃ©cupÃ¨re les relations de compatibilitÃ© entre types de catÃ©gories.

**Utilisation:** Pour afficher des suggestions de produits complÃ©mentaires (upselling/cross-selling).

**RÃ©ponse:**
```json
{
  "compatibilities": {
    "device": ["accessory", "service", "software"],
    "accessory": ["consumable"],
    "service": ["software"],
    "software": [],
    "consumable": []
  }
}
```

**InterprÃ©tation:**
- `device` est compatible avec `accessory`, `service`, et `software`
- Lorsqu'un client ajoute un "device", suggÃ©rer des produits de type "accessory", "service", ou "software"
- Les compatibilitÃ©s ne sont pas forcÃ©ment bidirectionnelles

**Exemple d'utilisation:**
```javascript
// Client ajoute un MacBook Pro (type: device)
const productType = "device";
const compatibleTypes = compatibilities[productType]; // ["accessory", "service", "software"]

// Afficher: "Accessoires recommandÃ©s", "Services associÃ©s", "Logiciels compatibles"
```

---

### GET /v1/{companySlug}/brands

Liste des marques disponibles avec le nombre de produits par marque.

**RÃ©ponse:**
```json
{
  "brands": [
    {
      "name": "Apple",
      "count": 87
    },
    {
      "name": "Dell",
      "count": 52
    },
    {
      "name": "HP",
      "count": 45
    },
    {
      "name": "Lenovo",
      "count": 38
    }
  ]
}
```

---

### POST /v1/{companySlug}/cart/submit

Soumet un panier pour crÃ©er une demande de devis.

**Body:**
```json
{
  "cart": [
    {
      "product_id": "550e8400-e29b-41d4-a716-446655440000",
      "quantity": 2,
      "duration": 36,
      "selected_options": {
        "storage": "512GB",
        "ram": "16GB"
      }
    }
  ],
  "customer": {
    "name": "Jean Dupont",
    "email": "jean.dupont@example.com",
    "company": "Acme Corp",
    "phone": "+32 471 23 45 67"
  },
  "message": "Demande de devis pour Ã©quiper 5 collaborateurs"
}
```

**RÃ©ponse succÃ¨s:**
```json
{
  "success": true,
  "id": "quote-789",
  "message": "Votre demande a Ã©tÃ© enregistrÃ©e avec succÃ¨s. Nous vous contacterons sous 24h."
}
```

**RÃ©ponse erreur:**
```json
{
  "success": false,
  "message": "Email client invalide"
}
```

---

## Gestion des erreurs

### Codes de statut HTTP

| Code | Signification | Description |
|------|---------------|-------------|
| 200 | OK | RequÃªte rÃ©ussie |
| 400 | Bad Request | ParamÃ¨tres invalides ou manquants |
| 401 | Unauthorized | ClÃ© API manquante ou invalide |
| 404 | Not Found | Ressource non trouvÃ©e |
| 429 | Too Many Requests | Limite de taux dÃ©passÃ©e |
| 500 | Internal Server Error | Erreur serveur |

### Format des erreurs

```json
{
  "error": "Message d'erreur descriptif",
  "code": "ERROR_CODE",
  "details": {
    "field": "DÃ©tails supplÃ©mentaires"
  }
}
```

### Exemples d'erreurs

**401 - ClÃ© API manquante:**
```json
{
  "error": "Missing API key",
  "code": "MISSING_API_KEY"
}
```

**404 - Produit non trouvÃ©:**
```json
{
  "error": "Product not found",
  "code": "PRODUCT_NOT_FOUND",
  "details": {
    "productId": "invalid-id-123"
  }
}
```

**429 - Rate limit dÃ©passÃ©:**
```json
{
  "error": "Rate limit exceeded",
  "code": "RATE_LIMIT_EXCEEDED",
  "details": {
    "retryAfter": 3600
  }
}
```

---

## Rate Limiting

### Limites

- **100 requÃªtes par heure** par adresse IP
- Les limites se rÃ©initialisent toutes les heures
- Les requÃªtes dÃ©passant la limite reÃ§oivent un code 429

### Headers de rÃ©ponse

Chaque rÃ©ponse inclut des headers indiquant votre utilisation:

```http
X-RateLimit-Limit: 100
X-RateLimit-Remaining: 87
X-RateLimit-Reset: 1700654400
```

**Description:**
- `X-RateLimit-Limit`: Limite totale de requÃªtes
- `X-RateLimit-Remaining`: Nombre de requÃªtes restantes
- `X-RateLimit-Reset`: Timestamp Unix de rÃ©initialisation

### Bonnes pratiques

1. **Mettre en cache les rÃ©ponses** (catÃ©gories, types, compatibilitÃ©s)
2. **ImplÃ©menter un retry avec backoff exponentiel**
3. **Surveiller le header `X-RateLimit-Remaining`**
4. **Grouper les requÃªtes** quand possible

---

## Exemples d'utilisation

### JavaScript / TypeScript avec ApiService

#### Installation

Copiez le fichier `api-service.txt` dans votre projet et importez-le:

```typescript
import { ApiService } from './services/ApiService';

const apiService = new ApiService('itakecare');
```

#### RÃ©cupÃ©rer les produits

```typescript
// Tous les produits
const catalog = await apiService.getPublicCatalog('itakecare');
console.log(catalog.products);

// Avec filtres
const filtered = await apiService.getPublicCatalog('itakecare', {
  search: 'macbook',
  category: 'cat-123',
  brand: 'Apple',
  minPrice: 1000,
  maxPrice: 2000,
  page: 1,
  limit: 20
});
```

#### RÃ©cupÃ©rer un produit spÃ©cifique

```typescript
const product = await apiService.getProductBySlug('itakecare', 'macbook-pro-13-m1');

if (product) {
  console.log(`${product.name} - ${product.monthly_price}â‚¬/mois`);
  
  // Afficher les variantes
  product.variants?.forEach(variant => {
    console.log(`${variant.name}: ${variant.monthly_price}â‚¬/mois`);
  });
}
```

#### RÃ©cupÃ©rer les catÃ©gories avec types enrichis

```typescript
const { categories } = await apiService.getCategories('itakecare');

categories.forEach(category => {
  // AccÃ©der au type enrichi
  const typeLabel = category.type.label; // "Appareil"
  const typeIcon = category.type.icon; // "ğŸ“±"
  const bgColor = category.type.bg_color; // "bg-blue-100"
  const textColor = category.type.text_color; // "text-blue-800"
  
  console.log(`${typeIcon} ${category.name} (${typeLabel})`);
  
  // Afficher impact environnemental si disponible
  if (category.environmental_impact) {
    const co2 = category.environmental_impact.co2_savings_kg;
    console.log(`ğŸ’š Ã‰conomie CO2: ${co2} kg`);
  }
});
```

#### â­ NOUVEAU - RÃ©cupÃ©rer les types de catÃ©gories

```typescript
const { category_types } = await apiService.getCategoryTypes();

// CrÃ©er une lÃ©gende visuelle
category_types.forEach(type => {
  console.log(`${type.icon} ${type.label}`);
  // Utiliser type.bg_color et type.text_color pour le style
});

// CrÃ©er des filtres dynamiques
const filters = category_types.map(type => ({
  label: type.label,
  value: type.value,
  icon: type.icon
}));
```

#### â­ NOUVEAU - Utiliser les compatibilitÃ©s pour suggestions

```typescript
const { compatibilities } = await apiService.getCategoryCompatibilities();

// Client sÃ©lectionne un MacBook (type: device)
const selectedProductType = "device";
const compatibleTypes = compatibilities[selectedProductType]; 
// ["accessory", "service", "software"]

// Filtrer les produits compatibles
const { categories } = await apiService.getCategories('itakecare');

const compatibleProducts = categories.filter(cat => 
  compatibleTypes.includes(cat.type.value)
);

console.log("Produits recommandÃ©s:");
compatibleProducts.forEach(cat => {
  console.log(`${cat.type.icon} ${cat.name}`);
});
```

#### Afficher des badges avec couleurs dynamiques

```typescript
import React from 'react';

function CategoryBadge({ category }) {
  return (
    <span className={`px-3 py-1 rounded-full ${category.type.bg_color} ${category.type.text_color}`}>
      <span className="mr-1">{category.type.icon}</span>
      {category.name}
    </span>
  );
}

// Utilisation
const { categories } = await apiService.getCategories('itakecare');
categories.map(cat => <CategoryBadge key={cat.id} category={cat} />)
```

#### Soumettre un panier

```typescript
const result = await apiService.submitCart('itakecare', {
  cart: [
    {
      product_id: "550e8400-e29b-41d4-a716-446655440000",
      quantity: 2,
      duration: 36,
      selected_options: {
        storage: "512GB",
        ram: "16GB"
      }
    }
  ],
  customer: {
    name: "Jean Dupont",
    email: "jean.dupont@example.com",
    company: "Acme Corp",
    phone: "+32 471 23 45 67"
  },
  message: "Demande de devis urgente"
});

if (result.success) {
  console.log("Devis envoyÃ©:", result.id);
}
```

---

### cURL

#### RÃ©cupÃ©rer les produits

```bash
curl -X GET \
  'https://cifbetjefyfocafanlhv.supabase.co/functions/v1/catalog-api/v1/itakecare/products?search=macbook&brand=Apple' \
  -H 'x-api-key: YOUR_API_KEY'
```

#### RÃ©cupÃ©rer un produit spÃ©cifique

```bash
curl -X GET \
  'https://cifbetjefyfocafanlhv.supabase.co/functions/v1/catalog-api/v1/itakecare/products/macbook-pro-13-m1' \
  -H 'x-api-key: YOUR_API_KEY'
```

#### RÃ©cupÃ©rer les catÃ©gories

```bash
curl -X GET \
  'https://cifbetjefyfocafanlhv.supabase.co/functions/v1/catalog-api/v1/itakecare/categories' \
  -H 'x-api-key: YOUR_API_KEY'
```

#### â­ NOUVEAU - RÃ©cupÃ©rer les types de catÃ©gories

```bash
curl -X GET \
  'https://cifbetjefyfocafanlhv.supabase.co/functions/v1/catalog-api/v1/itakecare/category-types' \
  -H 'x-api-key: YOUR_API_KEY'
```

#### â­ NOUVEAU - RÃ©cupÃ©rer les compatibilitÃ©s

```bash
curl -X GET \
  'https://cifbetjefyfocafanlhv.supabase.co/functions/v1/catalog-api/v1/itakecare/compatibilities' \
  -H 'x-api-key: YOUR_API_KEY'
```

#### RÃ©cupÃ©rer les marques

```bash
curl -X GET \
  'https://cifbetjefyfocafanlhv.supabase.co/functions/v1/catalog-api/v1/itakecare/brands' \
  -H 'x-api-key: YOUR_API_KEY'
```

#### Soumettre un panier

```bash
curl -X POST \
  'https://cifbetjefyfocafanlhv.supabase.co/functions/v1/catalog-api/v1/itakecare/cart/submit' \
  -H 'x-api-key: YOUR_API_KEY' \
  -H 'Content-Type: application/json' \
  -d '{
    "cart": [
      {
        "product_id": "550e8400-e29b-41d4-a716-446655440000",
        "quantity": 2,
        "duration": 36
      }
    ],
    "customer": {
      "name": "Jean Dupont",
      "email": "jean.dupont@example.com",
      "company": "Acme Corp",
      "phone": "+32 471 23 45 67"
    }
  }'
```

---

## Changelog

### Version 1.1.0 - 20 novembre 2025

#### âœ… Nouveaux endpoints

- **`GET /category-types`** - RÃ©cupÃ©rer tous les types de catÃ©gories avec propriÃ©tÃ©s visuelles (icÃ´nes, couleurs)
- **`GET /compatibilities`** - RÃ©cupÃ©rer les relations de compatibilitÃ© entre types de catÃ©gories

#### âœ… AmÃ©liorations majeures

- **Endpoint `/categories` enrichi:**
  - Le champ `type` retourne maintenant un objet `CategoryType` complet au lieu d'une simple string
  - Inclut `value`, `label`, `icon`, `bg_color`, `text_color`, `display_order`
  - Permet un affichage uniforme des catÃ©gories avec couleurs et icÃ´nes dynamiques

#### âœ… AmÃ©liorations techniques

- **IntÃ©gritÃ© des donnÃ©es:**
  - Ajout de contrainte de clÃ© Ã©trangÃ¨re `categories.type` â†’ `category_types.value`
  - RÃ¨gle `ON UPDATE CASCADE` pour synchronisation automatique
  - RÃ¨gle `ON DELETE RESTRICT` pour prÃ©venir la suppression de types utilisÃ©s

- **Performances:**
  - Index `idx_categories_type` sur `categories.type`
  - Index `idx_category_types_value` sur `category_types.value`
  - AmÃ©lioration des temps de rÃ©ponse des jointures

#### âš ï¸ Breaking Changes

**IMPORTANT:** Le format de rÃ©ponse de l'endpoint `/categories` a changÃ©.

**Avant (v1.0):**
```json
{
  "type": "device"  // String simple
}
```

**AprÃ¨s (v1.1):**
```json
{
  "type": {  // Objet enrichi
    "value": "device",
    "label": "Appareil",
    "icon": "ğŸ“±",
    "bg_color": "bg-blue-100",
    "text_color": "text-blue-800"
  }
}
```

**Migration nÃ©cessaire:** Voir section [Guide de migration](#guide-de-migration).

---

### Version 1.0.0 - Janvier 2025

#### âœ… FonctionnalitÃ©s initiales

- Endpoints de base pour produits, catÃ©gories, marques
- Filtrage et pagination des produits
- RÃ©cupÃ©ration de produits par ID ou slug
- Soumission de paniers pour devis
- Authentification par clÃ© API
- Rate limiting (100 req/h)

---

## Guide de migration

### Migration v1.0 â†’ v1.1

#### Changements nÃ©cessaires dans votre code

**1. AccÃ¨s au type de catÃ©gorie**

```typescript
// âŒ Avant (v1.0)
const categoryType = category.type; // "device"
const displayName = categoryType; // Affichage direct

// âœ… AprÃ¨s (v1.1)
const categoryType = category.type.value; // "device"
const displayName = category.type.label; // "Appareil"
const icon = category.type.icon; // "ğŸ“±"
```

**2. Affichage des badges**

```typescript
// âŒ Avant (v1.0) - Couleurs hardcodÃ©es
function getBadgeColor(type: string) {
  switch(type) {
    case 'device': return 'bg-blue-100 text-blue-800';
    case 'accessory': return 'bg-green-100 text-green-800';
    // ...
  }
}

// âœ… AprÃ¨s (v1.1) - Couleurs dynamiques
function CategoryBadge({ category }) {
  return (
    <span className={`${category.type.bg_color} ${category.type.text_color}`}>
      {category.type.icon} {category.type.label}
    </span>
  );
}
```

**3. Filtrage par type**

```typescript
// âŒ Avant (v1.0)
const devices = categories.filter(cat => cat.type === 'device');

// âœ… AprÃ¨s (v1.1)
const devices = categories.filter(cat => cat.type.value === 'device');
```

**4. Tri par type**

```typescript
// âŒ Avant (v1.0) - Pas d'ordre dÃ©fini
categories.sort((a, b) => a.type.localeCompare(b.type));

// âœ… AprÃ¨s (v1.1) - Ordre configurable
categories.sort((a, b) => a.type.display_order - b.type.display_order);
```

#### Nouvelles opportunitÃ©s v1.1

**1. RÃ©cupÃ©rer les types au chargement**

```typescript
// Au chargement de l'application
const { category_types } = await apiService.getCategoryTypes();

// Mettre en cache localement
localStorage.setItem('categoryTypes', JSON.stringify(category_types));

// Utiliser pour filtres, lÃ©gendes, etc.
```

**2. ImplÃ©menter des suggestions intelligentes**

```typescript
// RÃ©cupÃ©rer les compatibilitÃ©s
const { compatibilities } = await apiService.getCategoryCompatibilities();

// Quand un client ajoute un produit
function getSuggestedProducts(addedProduct, allProducts, compatibilities) {
  const productType = addedProduct.category.type.value;
  const compatibleTypes = compatibilities[productType] || [];
  
  return allProducts.filter(product => 
    compatibleTypes.includes(product.category.type.value)
  );
}
```

**3. Affichage uniforme avec Tailwind**

```tsx
import React from 'react';

function CategoryGrid({ categories }) {
  return (
    <div className="grid grid-cols-3 gap-4">
      {categories.map(category => (
        <div 
          key={category.id}
          className={`p-4 rounded-lg ${category.type.bg_color}`}
        >
          <div className="text-4xl mb-2">{category.type.icon}</div>
          <h3 className={`font-bold ${category.type.text_color}`}>
            {category.name}
          </h3>
          <p className="text-sm text-gray-600">
            {category.type.label}
          </p>
        </div>
      ))}
    </div>
  );
}
```

#### RÃ©trocompatibilitÃ©

Si vous ne pouvez pas migrer immÃ©diatement, vous pouvez crÃ©er un adaptateur temporaire:

```typescript
function adaptCategoryToV1Format(category) {
  return {
    ...category,
    type: category.type.value, // Convertir objet â†’ string
    type_label: category.type.label,
    type_icon: category.type.icon,
    type_colors: {
      bg: category.type.bg_color,
      text: category.type.text_color
    }
  };
}
```

---

## Cas d'usage recommandÃ©s

### 1. Catalogue externe / E-commerce

**Objectif:** Afficher le catalogue iTakecare sur votre site web.

**Workflow recommandÃ©:**

```typescript
// 1. Initialiser au chargement de la page
async function initCatalog() {
  // RÃ©cupÃ©rer les types et compatibilitÃ©s (Ã  mettre en cache)
  const types = await apiService.getCategoryTypes();
  const compatibilities = await apiService.getCategoryCompatibilities();
  
  // RÃ©cupÃ©rer les produits
  const catalog = await apiService.getPublicCatalog('itakecare', {
    limit: 50,
    page: 1
  });
  
  return { types, compatibilities, catalog };
}

// 2. Afficher avec filtres dynamiques basÃ©s sur les types
function CatalogFilters({ types, onFilterChange }) {
  return (
    <div className="flex gap-2">
      {types.category_types.map(type => (
        <button
          key={type.value}
          className={`px-4 py-2 rounded ${type.bg_color} ${type.text_color}`}
          onClick={() => onFilterChange(type.value)}
        >
          {type.icon} {type.label}
        </button>
      ))}
    </div>
  );
}

// 3. Afficher les suggestions de produits compatibles
function ProductSuggestions({ product, compatibilities, allProducts }) {
  const productType = product.category.type.value;
  const compatibleTypes = compatibilities[productType] || [];
  
  const suggestions = allProducts.filter(p =>
    compatibleTypes.includes(p.category.type.value) &&
    p.id !== product.id
  );
  
  return (
    <div>
      <h3>Produits recommandÃ©s</h3>
      {suggestions.map(p => <ProductCard key={p.id} product={p} />)}
    </div>
  );
}
```

---

### 2. Configurateur de pack

**Objectif:** Permettre aux clients de crÃ©er des packs personnalisÃ©s.

**Workflow recommandÃ©:**

```typescript
class PackConfigurator {
  constructor(apiService, compatibilities) {
    this.api = apiService;
    this.compatibilities = compatibilities;
    this.selectedProducts = [];
  }
  
  // Ajouter un produit et obtenir les suggestions
  async addProduct(product) {
    this.selectedProducts.push(product);
    
    // RÃ©cupÃ©rer les types compatibles
    const productType = product.category.type.value;
    const compatibleTypes = this.compatibilities[productType];
    
    // SuggÃ©rer des produits complÃ©mentaires
    const suggestions = await this.api.getPublicCatalog('itakecare', {
      category: compatibleTypes.join(','),
      limit: 10
    });
    
    return suggestions.products;
  }
  
  // Calculer le total mensuel
  calculateMonthlyTotal(duration = 36) {
    return this.selectedProducts.reduce((total, product) => {
      return total + (product.monthly_price * product.quantity);
    }, 0);
  }
  
  // Soumettre le pack
  async submitPack(customerInfo) {
    const cart = this.selectedProducts.map(product => ({
      product_id: product.id,
      quantity: product.quantity,
      duration: 36,
      selected_options: product.selectedOptions || {}
    }));
    
    return await this.api.submitCart('itakecare', {
      cart,
      customer: customerInfo,
      message: "Pack personnalisÃ©"
    });
  }
}

// Utilisation
const configurator = new PackConfigurator(apiService, compatibilities);

// Client ajoute un MacBook
const macbook = await apiService.getProductBySlug('itakecare', 'macbook-pro');
const suggestions = await configurator.addProduct(macbook);

console.log("Nous vous recommandons:", suggestions);
// â†’ Souris, clavier, sacoche, logiciels compatibles...
```

---

### 3. Application mobile

**Objectif:** IntÃ©grer le catalogue dans une app React Native / Flutter.

**Bonnes pratiques:**

```typescript
// 1. Cache local des types et compatibilitÃ©s
import AsyncStorage from '@react-native-async-storage/async-storage';

class CatalogCache {
  static async getCategoryTypes() {
    // VÃ©rifier le cache
    const cached = await AsyncStorage.getItem('categoryTypes');
    const cacheTime = await AsyncStorage.getItem('categoryTypesTime');
    
    // Cache valide 24h
    if (cached && Date.now() - parseInt(cacheTime) < 86400000) {
      return JSON.parse(cached);
    }
    
    // RÃ©cupÃ©rer depuis l'API
    const types = await apiService.getCategoryTypes();
    await AsyncStorage.setItem('categoryTypes', JSON.stringify(types));
    await AsyncStorage.setItem('categoryTypesTime', Date.now().toString());
    
    return types;
  }
  
  // MÃªme principe pour compatibilitÃ©s
}

// 2. Utiliser dans les composants
function CategoryList() {
  const [types, setTypes] = useState([]);
  const [categories, setCategories] = useState([]);
  
  useEffect(() => {
    async function loadData() {
      const cachedTypes = await CatalogCache.getCategoryTypes();
      setTypes(cachedTypes.category_types);
      
      const catalog = await apiService.getCategories('itakecare');
      setCategories(catalog.categories);
    }
    
    loadData();
  }, []);
  
  return (
    <ScrollView>
      {categories.map(cat => (
        <CategoryCard key={cat.id} category={cat} />
      ))}
    </ScrollView>
  );
}
```

---

### 4. Dashboard analytique

**Objectif:** Afficher des statistiques sur le catalogue.

**Exemple:**

```typescript
async function getCatalogStatistics() {
  const catalog = await apiService.getPublicCatalog('itakecare', {
    limit: 1000 // RÃ©cupÃ©rer tout
  });
  
  const types = await apiService.getCategoryTypes();
  
  // Statistiques par type
  const statsByType = types.category_types.map(type => {
    const productsOfType = catalog.products.filter(p =>
      p.category.type.value === type.value
    );
    
    return {
      type: type.label,
      icon: type.icon,
      count: productsOfType.length,
      avgPrice: productsOfType.reduce((sum, p) => sum + (p.price || 0), 0) / productsOfType.length,
      totalValue: productsOfType.reduce((sum, p) => sum + (p.price || 0), 0)
    };
  });
  
  return statsByType;
}

// Affichage
const stats = await getCatalogStatistics();
console.table(stats);

// RÃ©sultat:
// â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
// â”‚ Type         â”‚ Icon â”‚ Count    â”‚ Avg Price    â”‚
// â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
// â”‚ Appareil     â”‚ ğŸ“±   â”‚ 145      â”‚ 1,234 â‚¬      â”‚
// â”‚ Accessoire   â”‚ ğŸ”Œ   â”‚ 78       â”‚ 45 â‚¬         â”‚
// â”‚ Service      â”‚ ğŸ› ï¸   â”‚ 23       â”‚ 15 â‚¬/mois    â”‚
// â”‚ Logiciel     â”‚ ğŸ’¾   â”‚ 34       â”‚ 29 â‚¬/mois    â”‚
// â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 5. Widget catalogue iframe

**Objectif:** IntÃ©grer le catalogue iTakecare dans un site tiers via iframe.

**HTML:**

```html
<!DOCTYPE html>
<html>
<head>
  <title>Catalogue iTakecare</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="catalog-widget"></div>
  
  <script>
    const API_KEY = 'YOUR_API_KEY';
    const BASE_URL = 'https://cifbetjefyfocafanlhv.supabase.co/functions/v1/catalog-api';
    
    async function loadCatalog() {
      const response = await fetch(`${BASE_URL}/v1/itakecare/products`, {
        headers: { 'x-api-key': API_KEY }
      });
      
      const data = await response.json();
      const widget = document.getElementById('catalog-widget');
      
      widget.innerHTML = data.products.map(product => `
        <div class="border p-4 rounded-lg">
          <img src="${product.image_url}" alt="${product.name}" class="w-full h-48 object-cover mb-4">
          <span class="px-3 py-1 rounded-full text-sm ${product.category?.type?.bg_color} ${product.category?.type?.text_color}">
            ${product.category?.type?.icon} ${product.category?.type?.label}
          </span>
          <h3 class="text-lg font-bold mt-2">${product.name}</h3>
          <p class="text-gray-600">${product.short_description}</p>
          <p class="text-2xl font-bold mt-4">${product.monthly_price}â‚¬<span class="text-sm">/mois</span></p>
          <button class="mt-4 bg-blue-600 text-white px-4 py-2 rounded">Demander un devis</button>
        </div>
      `).join('');
    }
    
    loadCatalog();
  </script>
</body>
</html>
```

---

## Support

### Documentation technique

- **Types TypeScript:** Voir `catalog-skeleton/types-catalog.txt`
- **Service JavaScript:** Voir `catalog-skeleton/api-service.txt`
- **API Reference:** Voir `catalog-skeleton/API-REFERENCE.md`

### Contact iTakecare

- **Email:** hello@itakecare.be
- **TÃ©lÃ©phone:** +32 (0)71 49 16 85
- **Site web:** https://www.itakecare.be
- **LinkedIn:** https://www.linkedin.com/company/itakecare
- **Facebook:** https://www.facebook.com/itakecarebe

### Demande de clÃ© API

Pour obtenir votre clÃ© API, contactez-nous Ã  **hello@itakecare.be** en prÃ©cisant:
- Nom de votre entreprise
- Cas d'usage prÃ©vu
- Volume de requÃªtes estimÃ©

### Signaler un bug

Envoyez un email Ã  **hello@itakecare.be** avec:
- Description du problÃ¨me
- Endpoint concernÃ©
- RequÃªte et rÃ©ponse complÃ¨tes
- Timestamp de l'erreur

---

## Annexes

### Liste complÃ¨te des types de catÃ©gories (au 20/11/2025)

| Value | Label | Icon | Description |
|-------|-------|------|-------------|
| `device` | Appareil | ğŸ“± | Ordinateurs, smartphones, tablettes |
| `accessory` | Accessoire | ğŸ”Œ | Souris, claviers, cÃ¢bles, adaptateurs |
| `service` | Service | ğŸ› ï¸ | Support, maintenance, formation |
| `software` | Logiciel | ğŸ’¾ | Licences logicielles, abonnements |
| `consumable` | Consommable | ğŸ“¦ | Cartouches, papier, fournitures |

**Note:** Cette liste est dynamique et peut Ã©voluer. Utilisez l'endpoint `/category-types` pour obtenir la liste Ã  jour.

---

### CompatibilitÃ©s types (au 20/11/2025)

```
device â†’ accessory, service, software
accessory â†’ consumable
service â†’ software
software â†’ (aucune)
consumable â†’ (aucune)
```

**Note:** Ces compatibilitÃ©s peuvent Ã©voluer. Utilisez l'endpoint `/compatibilities` pour obtenir les relations Ã  jour.

---

### Performance et optimisation

**Temps de rÃ©ponse moyens:**
- `/products` (20 produits): ~200ms
- `/products/{id}`: ~150ms
- `/categories`: ~100ms
- `/category-types`: ~50ms (donnÃ©es lÃ©gÃ¨res)
- `/compatibilities`: ~50ms (donnÃ©es lÃ©gÃ¨res)

**Recommandations:**
1. **Mettre en cache** `/category-types` et `/compatibilities` (changent rarement)
2. **Paginer** les requÃªtes `/products` avec `limit=20-50`
3. **Filtrer cÃ´tÃ© API** plutÃ´t que rÃ©cupÃ©rer tout et filtrer localement
4. **Utiliser le slug** pour `/products/{productId}` (meilleur SEO)

---

**Document gÃ©nÃ©rÃ© le 20 novembre 2025**  
**Version 1.1.0**  
**Â© 2025 iTakecare SRL - Tous droits rÃ©servÃ©s**
